<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Wire the Stack: Constraint-First Migration Tracking with W3C Observability</title>
<script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove" defer></script>
<script class="remove">
var respecConfig = {
  specStatus: "unofficial",
  shortName: "wire-the-stack",
  edDraftURI: "https://quicue-apercue.pages.dev/phase7.html",
  editors: [{ name: "quicue", url: "https://quicue.ca" }],
  github: "https://github.com/quicue/apercue",
  noRecTrack: true,
  maxTocLevel: 3
};
</script>
<style>
  table { border-collapse: collapse; width: 100%; margin: 1em 0; }
  th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; font-size: 14px; }
  th { background: #f0f0f0; }
  code { font-size: 13px; }
  .status-done { color: #2e7d32; font-weight: bold; }
  .status-pending { color: #999; }
</style>
</head>
<body>

<section id="abstract">
<p>This document specifies the workflow for <strong>Phase 7: Wire the Stack</strong>,
a migration that integrates the <a href="https://apercue.ca">apercue.ca</a> typed
dependency graph library into the <a href="https://quicue.ca">quicue.ca</a>
infrastructure framework. The charter uses apercue's own
<code>#Charter</code> and <code>#GapAnalysis</code> patterns to track itself.</p>
<p>This specification is <strong>tool-agnostic</strong>. Any operator with
<a href="https://cuelang.org/">CUE</a> installed can execute the workflow.
W3C vocabulary terms are used throughout for interoperability.</p>
</section>

<section id="sotd">
<p>This is a living specification generated from the charter's CUE source.
Current status: <strong>4/33</strong> tasks complete.
Next gate: <strong>apercue-ready</strong>.</p>
</section>

<section>
<h2>Overview</h2>
<p>The project is a single CUE module (<code>phase7.quicue.ca</code>) containing
33 tasks organized into 6 sequential phases. Each task has a
<code>status</code> field (<code>"pending"</code> or <code>"done"</code>). A filtered
view feeds only completed tasks to the graph engine, so
<code>#GapAnalysis</code> tracks execution rather than just planning.</p>

<p>Critical path length: <strong>19</strong> steps
(computed via CPM scheduling with unit durations).</p>
</section>

<section>
<h2>W3C Vocabulary Alignment</h2>
<p>The charter maps CUE field names to W3C semantic IRIs via
<a href="https://www.w3.org/TR/json-ld11/">JSON-LD 1.1</a> context.</p>

<table>
<thead><tr><th>Field</th><th>W3C Property</th><th>Standard</th></tr></thead>
<tbody>
<tr><td>Task identity</td><td><code>dcterms:title</code></td><td>Dublin Core</td></tr>
<tr><td>Task description</td><td><code>dcterms:description</code></td><td>Dublin Core</td></tr>
<tr><td>Dependencies</td><td><code>dcterms:requires</code></td><td>Dublin Core</td></tr>
<tr><td>Status</td><td><code>schema:actionStatus</code></td><td>schema.org</td></tr>
<tr><td>Gap analysis</td><td><code>sh:ValidationReport</code></td><td>SHACL</td></tr>
<tr><td>CPM scheduling</td><td><code>time:Interval</code></td><td>OWL-Time</td></tr>
<tr><td>Type taxonomy</td><td><code>skos:ConceptScheme</code></td><td>SKOS</td></tr></tbody>
</table>
</section>

<section>
<h2>Task Taxonomy</h2>
<p>Tasks are typed using set-based typing: <code>"@type": {Migration: true, Bugfix: true}</code>.
The following types are declared in the charter scope:</p>

<table>
<thead><tr><th>Type</th><th>W3C Mapping</th><th>Description</th></tr></thead>
<tbody>
<tr><td><code>Setup</code></td><td><code>schema:actionStatus</code></td><td>Environment preparation — installing dependencies, creating symlinks</td></tr>
<tr><td><code>Test</code></td><td><code>schema:actionStatus</code></td><td>Validation through external W3C-compliant processors</td></tr>
<tr><td><code>Gate</code></td><td><code>schema:actionStatus</code></td><td>Phase boundary — all prerequisites must be satisfied to proceed</td></tr>
<tr><td><code>Verification</code></td><td><code>schema:actionStatus</code></td><td>Internal consistency checks — cue vet, export diffing</td></tr>
<tr><td><code>Migration</code></td><td><code>schema:actionStatus</code></td><td>Replacing local implementations with apercue imports</td></tr>
<tr><td><code>Bugfix</code></td><td><code>schema:actionStatus</code></td><td>Correcting defects discovered during integration</td></tr>
<tr><td><code>Cleanup</code></td><td><code>schema:actionStatus</code></td><td>Documentation, hygiene, and finalization tasks</td></tr></tbody>
</table>
</section>

<section>
<h2>Phase Gates</h2>
<p>The migration proceeds through 6 sequential gates. Each gate declares
required resources that must be completed before the gate is satisfied.
Gates may depend on other gates, enforcing phase ordering.</p>

<table>
<thead><tr><th>Gate</th><th>Phase</th><th>Status</th></tr></thead>
<tbody>
<tr><td>interop-proven</td><td>Phase 1</td><td>❌ </td></tr>
<tr><td>apercue-ready</td><td>Phase 2</td><td>❌ apercue-docs-rfc5737</td></tr>
<tr><td>quicue-integrated</td><td>Phase 3</td><td>❌ quicue-analysis-import, quicue-validation-import, quicue-charter-import, quicue-cpm-upgrade, quicue-shacl-fix</td></tr>
<tr><td>chain-verified</td><td>Phase 4</td><td>❌ quicue-vet, quicue-exports-diff, quicue-interop, grdn-vet, grdn-exports-diff, downstream-check</td></tr>
<tr><td>phase7-complete</td><td>Phase 5</td><td>❌ quicue-charter-update, memory-update, final-commit</td></tr>
<tr><td>w3c-aligned</td><td>Phase 6</td><td>❌ phase7-jsonld, phase7-skos-types, phase7-owl-time, quicue-export-context, quicue-earl-gaps, quicue-owl-time-fix, grdn-w3c-surface, kg-skos-federation, w3c-review, w3c-sweep-complete</td></tr></tbody>
</table>
</section>

<section>
<h2>Task Registry</h2>
<p>All 33 tasks with current status:</p>

<table>
<thead><tr><th>Task</th><th>Type</th><th>Status</th><th>Description</th><th>Dependencies</th></tr></thead>
<tbody>
<tr><td><code>interop-deps</code></td><td>Setup</td><td>done</td><td>Install pySHACL, rdflib, pyld for W3C interop validation</td><td>—</td></tr>
<tr><td><code>interop-tests</code></td><td>Test</td><td>done</td><td>Create tools/interop-test.py: validate JSON-LD, SHACL, SKOS, OWL-Time with standard processors</td><td>interop-deps</td></tr>
<tr><td><code>interop-pass</code></td><td>Gate</td><td>done</td><td>All 4 interop tests pass — apercue output is real W3C</td><td>interop-tests</td></tr>
<tr><td><code>apercue-importable</code></td><td>Verification</td><td>done</td><td>Verify apercue patterns export cleanly as apercue.ca/patterns@v0</td><td>interop-pass</td></tr>
<tr><td><code>apercue-docs-rfc5737</code></td><td>Cleanup</td><td>pending</td><td>Replace any real IPs in apercue docs/examples with RFC 5737 ranges</td><td>interop-pass</td></tr>
<tr><td><code>quicue-baseline</code></td><td>Verification</td><td>pending</td><td>Snapshot quicue.ca exports (metrics, SHACL, CPM) for regression diffing</td><td>apercue-importable</td></tr>
<tr><td><code>quicue-symlink</code></td><td>Setup</td><td>pending</td><td>Create cue.mod/pkg/apercue.ca@v0 symlink in quicue.ca</td><td>quicue-baseline</td></tr>
<tr><td><code>quicue-analysis-import</code></td><td>Migration</td><td>pending</td><td>Replace #CycleDetector, #ConnectedComponents, #Subgraph, #GraphDiff with apercue imports</td><td>quicue-symlink</td></tr>
<tr><td><code>quicue-validation-import</code></td><td>Migration</td><td>pending</td><td>Replace 5 validators + #ComplianceCheck with apercue imports, keep #IPRangeValidation</td><td>quicue-symlink</td></tr>
<tr><td><code>quicue-charter-import</code></td><td>Migration</td><td>pending</td><td>Replace #Charter, #Gate, #GapAnalysis with apercue imports, keep #InfraCharter + EARL</td><td>quicue-symlink</td></tr>
<tr><td><code>quicue-cpm-upgrade</code></td><td>Migration</td><td>pending</td><td>Replace #CriticalPath with apercue O(n) version + add #CriticalPathPrecomputed</td><td>quicue-analysis-import</td></tr>
<tr><td><code>quicue-shacl-fix</code></td><td>Bugfix</td><td>pending</td><td>Add @context to quicue SHACL reports (missing in current version)</td><td>quicue-validation-import</td></tr>
<tr><td><code>quicue-vet</code></td><td>Verification</td><td>pending</td><td>cue vet passes on all quicue.ca packages</td><td>quicue-analysis-import, quicue-validation-import, quicue-charter-import, quicue-cpm-upgrade, quicue-shacl-fix</td></tr>
<tr><td><code>quicue-exports-diff</code></td><td>Verification</td><td>pending</td><td>Diff quicue exports against baseline — metrics/CPM identical, SHACL gains @context</td><td>quicue-vet</td></tr>
<tr><td><code>quicue-interop</code></td><td>Test</td><td>pending</td><td>Run W3C interop tests against quicue.ca output</td><td>quicue-exports-diff</td></tr>
<tr><td><code>grdn-symlink</code></td><td>Setup</td><td>pending</td><td>Add apercue.ca@v0 transitive symlink to grdn cue.mod/pkg/</td><td>quicue-vet</td></tr>
<tr><td><code>grdn-vet</code></td><td>Verification</td><td>pending</td><td>cue vet passes on grdn (transitive dependency through quicue)</td><td>grdn-symlink</td></tr>
<tr><td><code>grdn-exports-diff</code></td><td>Verification</td><td>pending</td><td>grdn exports unchanged after integration</td><td>grdn-vet</td></tr>
<tr><td><code>downstream-check</code></td><td>Verification</td><td>pending</td><td>make check-downstream passes in quicue.ca</td><td>quicue-interop, grdn-exports-diff</td></tr>
<tr><td><code>quicue-charter-update</code></td><td>Cleanup</td><td>pending</td><td>Mark quicue Phase 7 apercue-integrated gate as satisfied</td><td>downstream-check</td></tr>
<tr><td><code>memory-update</code></td><td>Cleanup</td><td>pending</td><td>Update apercue and quicue MEMORY.md with integration status</td><td>downstream-check</td></tr>
<tr><td><code>quicue-docs-rfc5737</code></td><td>Cleanup</td><td>pending</td><td>Replace any real IPs in quicue docs with RFC 5737 ranges</td><td>downstream-check</td></tr>
<tr><td><code>final-commit</code></td><td>Gate</td><td>pending</td><td>All repos committed, charters updated, interop passing</td><td>quicue-charter-update, memory-update, quicue-docs-rfc5737</td></tr>
<tr><td><code>phase7-jsonld</code></td><td>Migration</td><td>pending</td><td>Add JSON-LD @context to charter_viz and summary exports using apercue vocab</td><td>final-commit</td></tr>
<tr><td><code>phase7-skos-types</code></td><td>Migration</td><td>pending</td><td>Project task type taxonomy as SKOS ConceptScheme</td><td>final-commit</td></tr>
<tr><td><code>phase7-owl-time</code></td><td>Migration</td><td>pending</td><td>Project CPM scheduling data as OWL-Time time:Interval</td><td>final-commit</td></tr>
<tr><td><code>quicue-export-context</code></td><td>Bugfix</td><td>pending</td><td>Add @context + @type + dct:conformsTo to all quicue.ca export-facing definitions (INSIGHT-013)</td><td>final-commit</td></tr>
<tr><td><code>quicue-earl-gaps</code></td><td>Migration</td><td>pending</td><td>Add EARL earl:Assertion projection to #GapAnalysis for audit trail</td><td>final-commit</td></tr>
<tr><td><code>quicue-owl-time-fix</code></td><td>Bugfix</td><td>pending</td><td>Fix #CriticalPath time_report to emit proper OWL-Time intervals</td><td>final-commit</td></tr>
<tr><td><code>grdn-w3c-surface</code></td><td>Migration</td><td>pending</td><td>Surface inherited W3C projections in grdn docs and exports</td><td>phase7-jsonld, phase7-skos-types, phase7-owl-time, quicue-export-context, quicue-earl-gaps, quicue-owl-time-fix</td></tr>
<tr><td><code>kg-skos-federation</code></td><td>Migration</td><td>pending</td><td>Add cross-project skos:exactMatch/skos:closeMatch for pattern discovery across .kb/ directories</td><td>phase7-jsonld, phase7-skos-types, phase7-owl-time, quicue-export-context, quicue-earl-gaps, quicue-owl-time-fix</td></tr>
<tr><td><code>w3c-review</code></td><td>Verification</td><td>pending</td><td>Iterative review: re-export all W3C artifacts, run interop tests, doc sweep, verify shareable URLs</td><td>grdn-w3c-surface, kg-skos-federation</td></tr>
<tr><td><code>w3c-sweep-complete</code></td><td>Gate</td><td>pending</td><td>All W3C alignment tasks pass, documentation updated, exports validated</td><td>w3c-review</td></tr></tbody>
</table>
</section>

<section>
<h2>Tracking Workflow</h2>

<section>
<h3>Marking Tasks Done</h3>
<p>To mark a task as completed, add <code>status: "done"</code> to the task
definition in <code>charter.cue</code>:</p>
<pre class="example" title="Marking a task complete">
"interop-deps": {
    status:      "done"
    name:        "interop-deps"
    "@type":     {Setup: true}
    description: "Install pySHACL, rdflib, pyld for W3C interop validation"
}</pre>
<p>Tasks without an explicit <code>status</code> default to <code>"pending"</code>.</p>
</section>

<section>
<h3>Checking Progress</h3>
<p>All progress queries use <code>cue export</code> with expression selectors:</p>
<pre class="example" title="Export commands">
# Progress summary (JSON)
cue export . -e summary --out json

# SHACL gap report (W3C sh:ValidationReport)
cue export . -e gaps.shacl_report --out json

# D3 visualization data (with CPM scheduling)
cue export . -e charter_viz --out json

# Workflow specification (this document)
cue export . -e spec_html --out text > docs/workflow.html
</pre>
</section>

<section>
<h3>Validation</h3>
<pre class="example" title="Validation commands">
# Structural validation
cue vet .

# Test suite
./tests/validate.sh            # structural + zero-state assertions
./tests/test-precomputed.sh    # precomputed.cue consistency
</pre>
</section>

<section>
<h3>Regenerating Topology</h3>
<p>When tasks or dependencies change, regenerate the precomputed topology:</p>
<pre class="example" title="Regenerate precomputed data">
python3 ~/apercue/tools/toposort.py charter.cue --cue \
  | sed 's/^_precomputed:/_precomputed_full:/' > precomputed.cue
./tests/test-precomputed.sh
</pre>
</section>
</section>

<section>
<h2>Dependencies</h2>
<p>The module imports from <code>apercue.ca@v0</code>, resolved via OCI registry:</p>
<ul>
<li><code>apercue.ca/patterns@v0</code> — graph analysis (<code>#GraphLite</code>)</li>
<li><code>apercue.ca/charter@v0</code> — <code>#Charter</code>, <code>#GapAnalysis</code></li>
</ul>
<p>Declared in <code>cue.mod/module.cue</code> as
<code>deps: "apercue.ca@v0": v: "v0.0.1"</code>.
Requires the OCI registry container running:
<code>docker start cue-registry</code>.</p>
</section>

<section>
<h2>Ecosystem</h2>
<pre>
phase7.quicue.ca (this charter)
    ↓ imports
apercue.ca@v0 (typed dependency graph library)
    ↓ being wired into
quicue.ca (infrastructure framework)
    ↓ validated by
grdn, cmhc-retrofit, maison-613, et al. (downstream)
</pre>
</section>

</body>
</html>
