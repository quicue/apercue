<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Context Graphs CG Report — apercue.ca</title>
<style>
  :root {
    --bg: #fafafa;
    --fg: #1a1a1a;
    --accent: #2563eb;
    --code-bg: #f3f4f6;
    --border: #d1d5db;
    --max-w: 48rem;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #111827;
      --fg: #e5e7eb;
      --accent: #60a5fa;
      --code-bg: #1f2937;
      --border: #374151;
    }
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
    background: var(--bg);
    color: var(--fg);
    line-height: 1.7;
    padding: 2rem 1rem;
    max-width: var(--max-w);
    margin: 0 auto;
  }
  nav {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
    font-size: 0.875rem;
  }
  nav a { color: var(--accent); text-decoration: none; }
  nav a:hover { text-decoration: underline; }
  h1 { font-size: 1.75rem; margin: 1.5rem 0 0.75rem; }
  h2 { font-size: 1.35rem; margin: 1.5rem 0 0.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.25rem; }
  h3 { font-size: 1.1rem; margin: 1.25rem 0 0.5rem; }
  p { margin: 0.75rem 0; }
  a { color: var(--accent); }
  ul, ol { margin: 0.75rem 0 0.75rem 1.5rem; }
  li { margin: 0.25rem 0; }
  code {
    background: var(--code-bg);
    padding: 0.15em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
    font-family: "SF Mono", "Fira Code", Consolas, monospace;
  }
  pre {
    background: var(--code-bg);
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1rem 0;
    border: 1px solid var(--border);
  }
  pre code {
    background: none;
    padding: 0;
    font-size: 0.85em;
    line-height: 1.5;
  }
  blockquote {
    border-left: 3px solid var(--accent);
    padding-left: 1rem;
    margin: 1rem 0;
    color: #6b7280;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin: 1rem 0;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid var(--border);
    padding: 0.5rem 0.75rem;
    text-align: left;
  }
  th { background: var(--code-bg); font-weight: 600; }
  hr { border: none; border-top: 1px solid var(--border); margin: 1.5rem 0; }
  strong { font-weight: 600; }
  .meta {
    color: #6b7280;
    font-size: 0.875rem;
    margin-top: 3rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }
</style>
</head>
<body>
<nav>
  <a href="../index.html">apercue.ca</a> /
  <a href="index.html">W3C Reports</a> /
  Context Graphs CG Report
</nav>
<h1 id="struct-as-set-type-multi-context-resource-identity-in-cue">Struct-as-Set @type: Multi-Context Resource Identity in CUE</h1>
<p><strong>Use Case Submission for the Context Graphs Community Group</strong></p>
<hr>
<h2 id="summary">Summary</h2>
<p><a href="https://github.com/quicue/apercue">apercue.ca</a> represents resource types
as CUE structs (<code>{TypeA: true, TypeB: true}</code>) rather than arrays or class
hierarchies. This "struct-as-set" pattern gives every resource simultaneous
membership in multiple contexts — data governance, provenance, scheduling,
semantic web — resolved through set intersection at evaluation time.</p>
<p>This submission demonstrates how CUE's type system naturally models the
multi-context identity that the Context Graphs CG investigates.</p>
<h2 id="the-pattern-type-as-a-set">The Pattern: @type as a Set</h2>
<p>Each resource declares its types as a struct with boolean values:</p>
<pre><code class="language-cue">&quot;sensor-dataset&quot;: {
    name:       &quot;sensor-dataset&quot;
    &quot;@type&quot;:    {Dataset: true, Schedulable: true, Governed: true}
    depends_on: {&quot;ethics-approval&quot;: true}
}
</code></pre>
<p>This resource exists simultaneously in three contexts:
- <strong>Dataset</strong> context: subject to provenance tracking
- <strong>Schedulable</strong> context: subject to critical path analysis
- <strong>Governed</strong> context: subject to embargo and access policies</p>
<p>No context is primary. No context is added after the fact. The resource IS
all of these simultaneously, and CUE unification guarantees consistency
across all contexts.</p>
<h2 id="how-context-resolution-works">How Context Resolution Works</h2>
<h3 id="set-intersection-as-dispatch">Set Intersection as Dispatch</h3>
<p>Providers (tools, validators, policies) declare which types they serve:</p>
<pre><code class="language-cue">for tname, _ in provider.types
if resource[&quot;@type&quot;][tname] != _|_ {tname}
</code></pre>
<p>A resource with <code>{Dataset: true, Governed: true}</code> matches a data
repository (serves Dataset) AND an ethics board (serves Governed)
simultaneously. The binding is set intersection, not registration.</p>
<h3 id="unification-guarantees-consistency">Unification Guarantees Consistency</h3>
<p>If two contexts place conflicting constraints on the same resource, CUE
unification produces bottom (<code>_|_</code>). The graph cannot be constructed. This
is not a runtime error — it is a type error caught before any output is
generated.</p>
<h2 id="evidence-multiple-projections-from-one-graph">Evidence: Multiple Projections From One Graph</h2>
<p>The same 5-node research publication graph (defined once) produces output in
13 different W3C specifications. Each projection
selects a different context:</p>
<table>
<thead>
<tr>
<th>Context</th>
<th>W3C Specification</th>
<th>Projection Expression</th>
</tr>
</thead>
<tbody>
<tr><td>Scheduling</td><td>OWL-Time</td><td><code>cue export -e time_report</code></td></tr>
<tr><td>Compliance</td><td>SHACL</td><td><code>cue export -e compliance</code></td></tr>
<tr><td>Provenance</td><td>PROV-O</td><td><code>cue export -e provenance</code></td></tr>
<tr><td>Access control</td><td>ODRL</td><td><code>cue export -e access_policy</code></td></tr>
<tr><td>Cataloging</td><td>DCAT</td><td><code>cue export -e dcat_catalog</code></td></tr>
<tr><td>Testing</td><td>EARL</td><td><code>cue export -e test_plan</code></td></tr>
<tr><td>Vocabulary</td><td>SKOS</td><td><code>cue export -e type_registry</code></td></tr>
<tr><td>Identity</td><td>JSON-LD</td><td><code>cue export -e context</code></td></tr>
</tbody>
</table>
<p>Resource identity (<code>@id</code>) is stable across all projections because the graph
is the single source of truth.</p>
<p><strong>Scheduling context</strong> (OWL-Time):</p>
<pre><code class="language-json">{
    &quot;@type&quot;: &quot;time:Interval&quot;,
    &quot;@id&quot;: &quot;urn:resource:analysis-code&quot;,
    &quot;dcterms:title&quot;: &quot;analysis-code&quot;,
    &quot;time:hasBeginning&quot;: {
        &quot;@type&quot;: &quot;time:Instant&quot;,
        &quot;time:inXSDDecimal&quot;: 150
    },
    &quot;time:hasEnd&quot;: {
        &quot;@type&quot;: &quot;time:Instant&quot;,
        &quot;time:inXSDDecimal&quot;: 195
    },
    &quot;time:hasDuration&quot;: {
        &quot;@type&quot;: &quot;time:Duration&quot;,
        &quot;time:numericDuration&quot;: 45,
        &quot;time:unitType&quot;: {
            &quot;@id&quot;: &quot;time:unitDay&quot;
        }
    },
    &quot;apercue:slack&quot;: 0,
    &quot;apercue:isCritical&quot;: true
}
</code></pre>
<p><strong>Compliance context</strong> (SHACL):</p>
<pre><code class="language-json">{
    &quot;@type&quot;: &quot;sh:ValidationReport&quot;,
    &quot;sh:conforms&quot;: true,
    &quot;sh:result&quot;: []
}
</code></pre>
<p><strong>Provenance context</strong> (PROV-O):</p>
<pre><code class="language-json">{
    &quot;@type&quot;: &quot;prov:Entity&quot;,
    &quot;@id&quot;: &quot;urn:resource:analysis-code&quot;,
    &quot;dcterms:title&quot;: &quot;analysis-code&quot;,
    &quot;prov:wasAttributedTo&quot;: {
        &quot;@id&quot;: &quot;apercue:graph-engine&quot;
    },
    &quot;prov:wasDerivedFrom&quot;: [
        {
            &quot;@id&quot;: &quot;urn:resource:sensor-dataset&quot;
        }
    ],
    &quot;prov:wasGeneratedBy&quot;: {
        &quot;@id&quot;: &quot;apercue:graph-construction&quot;
    }
}
</code></pre>
<p><strong>Access control context</strong> (ODRL):</p>
<pre><code class="language-json">{
    &quot;@type&quot;: &quot;odrl:Set&quot;,
    &quot;odrl:uid&quot;: &quot;apercue:graph-policy&quot;,
    &quot;odrl:permission&quot;: [
        {
            &quot;odrl:action&quot;: {
                &quot;@id&quot;: &quot;odrl:read&quot;
            }
        },
        {
            &quot;odrl:action&quot;: {
                &quot;@id&quot;: &quot;odrl:execute&quot;
            },
            &quot;odrl:assignee&quot;: {
                &quot;@id&quot;: &quot;apercue:operator&quot;
            }
        }
    ],
    &quot;odrl:prohibition&quot;: []
}
</code></pre>
<p>Each projection is a <code>cue export -e &lt;expression&gt;</code> invocation. The resource
identity is stable across all contexts because the graph is the single
source of truth.</p>
<h2 id="relevance-to-context-graphs">Relevance to Context Graphs</h2>
<table>
<thead>
<tr>
<th>Context Graphs Concern</th>
<th>CUE Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td>Multi-context identity</td>
<td><code>@type</code> struct-as-set: <code>{A: true, B: true}</code></td>
</tr>
<tr>
<td>Context binding</td>
<td>Set intersection between resource types and provider types</td>
</tr>
<tr>
<td>Cross-context consistency</td>
<td>CUE unification — conflicts are type errors</td>
</tr>
<tr>
<td>Context-specific views</td>
<td><code>cue export -e &lt;projection&gt;</code> per context</td>
</tr>
<tr>
<td>Context composition</td>
<td>Struct merging: <code>{A: true} &amp; {B: true}</code> = <code>{A: true, B: true}</code></td>
</tr>
</tbody>
</table>
<p>CUE's lattice semantics mean that context composition is not a graph
operation — it is type unification. Adding a context to a resource is
adding a key to a struct. Merging contexts is struct unification. Testing
context membership is field presence.</p>
<h2 id="multi-domain-evidence">Multi-Domain Evidence</h2>
<p>This pattern has been validated across four domains:</p>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Resources</th>
<th>Contexts Per Resource</th>
</tr>
</thead>
<tbody>
<tr>
<td>Research data mgmt</td>
<td>5 resources</td>
<td>Dataset + governance + scheduling</td>
</tr>
<tr>
<td>IT infrastructure</td>
<td>30 nodes</td>
<td>2-4 types per resource</td>
</tr>
<tr>
<td>University curricula</td>
<td>12 courses</td>
<td>Department + prerequisite + scheduling</td>
</tr>
<tr>
<td>Construction PM</td>
<td>18 work packages</td>
<td>Phase + gate + compliance</td>
</tr>
</tbody>
</table>
<p>The same <code>#Graph</code> pattern, the same set intersection dispatch. The contexts
are domain-specific; the mechanism is universal.</p>
<h2 id="discussion">Discussion</h2>
<p>This approach treats context as a first-class property of resources rather than
an external annotation. The key trade-off is expressiveness vs. guarantees:
CUE's closed-world lattice semantics provide strong consistency guarantees but
cannot model open-world context discovery.</p>
<p>For the Context Graphs CG's investigations into how context affects graph
structure and querying, the struct-as-set pattern offers a concrete,
implemented example of compile-time multi-context identity with formal
consistency guarantees.</p>
<h2 id="limitations">Limitations</h2>
<ul>
<li>Closed-world: contexts must be declared, not discovered</li>
<li>Flat namespace: no hierarchical context inheritance (by design — keeps dispatch simple)</li>
<li>Boolean membership only: no weighted or probabilistic context participation</li>
<li>Static: context assignment is compile-time, not dynamic</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/quicue/apercue/blob/main/w3c/core-report.md">Core report</a>
  — Full implementation evidence</li>
<li><a href="https://github.com/quicue/apercue">github.com/quicue/apercue</a> — Source (Apache 2.0)</li>
</ul>
<div class="meta">
  <p>Source: <a href="https://github.com/quicue/apercue/tree/main/w3c">github.com/quicue/apercue/tree/main/w3c</a></p>
  <p>All evidence is computed from CUE source. Reproduce: <code>cue export ./w3c/ -e evidence --out json</code></p>
</div>
</body>
</html>
